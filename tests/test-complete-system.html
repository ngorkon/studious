<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete AI System Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f2f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { color: #2196f3; margin: 0; font-size: 2.5rem; }
        .header p { color: #666; font-size: 1.1rem; margin: 10px 0; }
        .test-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 30px 0; }
        .test-card { background: #f8f9fa; border: 1px solid #ddd; border-radius: 10px; padding: 20px; }
        .test-card h3 { margin: 0 0 15px 0; color: #333; }
        .test-result { margin: 15px 0; padding: 12px; border-radius: 8px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .loading { background: #e2e3e5; color: #383d41; border: 1px solid #d6d8db; }
        button { background: #007bff; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem; width: 100%; margin: 5px 0; }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .output { background: #f8f9fa; border: 1px solid #e9ecef; padding: 15px; border-radius: 6px; font-family: monospace; white-space: pre-wrap; max-height: 200px; overflow-y: auto; margin: 10px 0; font-size: 0.9rem; }
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .status-online { background: #28a745; }
        .status-offline { background: #dc3545; }
        .status-unknown { background: #ffc107; }
        .feature-list { list-style: none; padding: 0; }
        .feature-list li { padding: 8px 0; border-bottom: 1px solid #eee; }
        .feature-list li:last-child { border-bottom: none; }
        .feature-status { float: right; font-weight: bold; }
        .progress-bar { width: 100%; height: 6px; background: #e9ecef; border-radius: 3px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #007bff, #28a745); transition: width 0.3s ease; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ AI Study System - Complete Test Suite</h1>
            <p>Comprehensive testing of all AI-powered features using Ollama llama3.2:3b</p>
            <div class="progress-bar">
                <div class="progress-fill" id="overallProgress" style="width: 0%"></div>
            </div>
        </div>

        <div class="test-grid">
            <!-- System Status -->
            <div class="test-card">
                <h3>üîß System Status</h3>
                <div id="systemStatus">
                    <div class="test-result loading">Checking system status...</div>
                </div>
                <ul class="feature-list" id="featureList">
                    <li>Ollama Server <span class="feature-status" id="ollamaStatus">‚è≥</span></li>
                    <li>LocalLLMProvider <span class="feature-status" id="providerStatus">‚è≥</span></li>
                    <li>AISmartScheduler <span class="feature-status" id="schedulerStatus">‚è≥</span></li>
                    <li>FlashcardGenerator <span class="feature-status" id="flashcardStatus">‚è≥</span></li>
                </ul>
            </div>

            <!-- AI Chat Test -->
            <div class="test-card">
                <h3>üí¨ AI Communication</h3>
                <button onclick="testAIChat()" id="chatTestBtn">Test AI Response</button>
                <div id="chatResult" class="test-result info">Click button to test AI chat</div>
                <div id="chatOutput" class="output"></div>
            </div>

            <!-- Flashcard Generation -->
            <div class="test-card">
                <h3>üéØ AI Flashcard Generation</h3>
                <button onclick="testFlashcardGeneration()" id="flashcardBtn">Generate AI Flashcards</button>
                <div id="flashcardResult" class="test-result info">Click button to generate flashcards</div>
                <div id="flashcardOutput" class="output"></div>
            </div>

            <!-- Smart Schedule -->
            <div class="test-card">
                <h3>üìÖ Smart Schedule Generation</h3>
                <button onclick="testSmartSchedule()" id="scheduleBtn">Generate Smart Schedule</button>
                <div id="scheduleResult" class="test-result info">Click button to generate schedule</div>
                <div id="scheduleOutput" class="output"></div>
            </div>

            <!-- Learning Profile -->
            <div class="test-card">
                <h3>üß† Learning Profile Analysis</h3>
                <button onclick="testLearningProfile()" id="profileBtn">Analyze Learning Profile</button>
                <div id="profileResult" class="test-result info">Click button to analyze profile</div>
                <div id="profileOutput" class="output"></div>
            </div>

            <!-- Performance Test -->
            <div class="test-card">
                <h3>‚ö° Performance Metrics</h3>
                <button onclick="runPerformanceTest()" id="perfBtn">Run Performance Test</button>
                <div id="perfResult" class="test-result info">Click button to test performance</div>
                <div id="perfOutput" class="output"></div>
            </div>
        </div>

        <div class="test-card" style="margin-top: 30px;">
            <h3>üìä Complete System Integration Test</h3>
            <button onclick="runFullSystemTest()" id="fullTestBtn" style="background: #28a745;">Run Complete Test Suite</button>
            <div id="fullTestResult" class="test-result info">Ready to run complete system test</div>
            <div id="fullTestOutput" class="output"></div>
        </div>
    </div>

    <!-- Load all the required scripts -->
    <script src="assets/js/models/Store.js"></script>
    <script src="assets/js/models/Utils.js"></script>
    <script src="assets/js/models/LocalLLMProvider.js"></script>
    <script src="assets/js/models/AIFlashcardGenerator.js"></script>
    <script src="assets/js/models/AISmartScheduler.js"></script>
    <script src="assets/js/models/UserLearningProfile.js"></script>
    <script src="assets/js/models/BiorhythmAnalyzer.js"></script>
    <script src="assets/js/models/ScheduleOptimizer.js"></script>
    <script src="assets/js/models/ContextAwareScheduling.js"></script>
    <script src="assets/js/controllers/SmartScheduleController.js"></script>

    <script>
        let testResults = {};
        let completedTests = 0;
        const totalTests = 6;

        function updateProgress() {
            const progress = (completedTests / totalTests) * 100;
            document.getElementById('overallProgress').style.width = progress + '%';
        }

        function updateStatus(elementId, status, text) {
            const element = document.getElementById(elementId);
            const indicators = { '‚úÖ': 'success', '‚ùå': 'error', '‚ö†Ô∏è': 'warning', '‚è≥': 'loading' };
            element.textContent = status;
            element.className = `feature-status ${indicators[status] || 'info'}`;
        }

        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `test-result ${type}`;
            element.textContent = message;
        }

        function showOutput(elementId, data) {
            const element = document.getElementById(elementId);
            if (typeof data === 'object') {
                element.textContent = JSON.stringify(data, null, 2);
            } else {
                element.textContent = data;
            }
        }

        // System Status Check
        async function checkSystemStatus() {
            console.log('üîç Checking system status...');
            
            try {
                // Check Ollama
                const ollamaResponse = await fetch('http://localhost:11434/api/tags');
                if (ollamaResponse.ok) {
                    updateStatus('ollamaStatus', '‚úÖ');
                } else {
                    updateStatus('ollamaStatus', '‚ùå');
                }
            } catch (error) {
                updateStatus('ollamaStatus', '‚ùå');
            }

            // Check components
            updateStatus('providerStatus', typeof LocalLLMProvider !== 'undefined' ? '‚úÖ' : '‚ùå');
            updateStatus('schedulerStatus', typeof AISmartScheduler !== 'undefined' ? '‚úÖ' : '‚ùå');
            updateStatus('flashcardStatus', typeof AIFlashcardGenerator !== 'undefined' ? '‚úÖ' : '‚ùå');

            const allGood = document.querySelectorAll('.feature-status').length === 
                           document.querySelectorAll('.feature-status:contains("‚úÖ")').length;
            
            showResult('systemStatus', allGood ? 'All systems operational!' : 'Some components need attention', allGood ? 'success' : 'warning');
        }

        // AI Chat Test
        async function testAIChat() {
            const btn = document.getElementById('chatTestBtn');
            btn.disabled = true;
            showResult('chatResult', 'Testing AI communication...', 'loading');

            try {
                const provider = new LocalLLMProvider();
                const startTime = Date.now();
                
                const response = await provider.generateResponse('Hello! Please respond with a brief introduction about yourself as an AI study assistant.');
                
                const endTime = Date.now();
                const duration = ((endTime - startTime) / 1000).toFixed(2);

                showResult('chatResult', `AI response received in ${duration}s!`, 'success');
                showOutput('chatOutput', `Response: ${response}\n\nDuration: ${duration} seconds`);
                
                testResults.aiChat = { success: true, duration, response };
                completedTests++;
                updateProgress();

            } catch (error) {
                showResult('chatResult', `AI communication failed: ${error.message}`, 'error');
                showOutput('chatOutput', `Error: ${error.message}`);
                testResults.aiChat = { success: false, error: error.message };
            }

            btn.disabled = false;
        }

        // Flashcard Generation Test
        async function testFlashcardGeneration() {
            const btn = document.getElementById('flashcardBtn');
            btn.disabled = true;
            showResult('flashcardResult', 'Generating AI flashcards...', 'loading');

            try {
                const generator = new AIFlashcardGenerator();
                const startTime = Date.now();
                
                const testContent = "Photosynthesis is the process by which plants convert sunlight, carbon dioxide, and water into glucose and oxygen.";
                const flashcards = await generator.generateFlashcards(testContent, 3);
                
                const endTime = Date.now();
                const duration = ((endTime - startTime) / 1000).toFixed(2);

                showResult('flashcardResult', `Generated ${flashcards.length} flashcards in ${duration}s!`, 'success');
                showOutput('flashcardOutput', flashcards);
                
                testResults.flashcards = { success: true, duration, count: flashcards.length };
                completedTests++;
                updateProgress();

            } catch (error) {
                showResult('flashcardResult', `Flashcard generation failed: ${error.message}`, 'error');
                showOutput('flashcardOutput', `Error: ${error.message}`);
                testResults.flashcards = { success: false, error: error.message };
            }

            btn.disabled = false;
        }

        // Smart Schedule Test
        async function testSmartSchedule() {
            const btn = document.getElementById('scheduleBtn');
            btn.disabled = true;
            showResult('scheduleResult', 'Generating smart schedule...', 'loading');

            try {
                const scheduler = new AISmartScheduler();
                const startTime = Date.now();
                
                const testData = {
                    subjects: ['Mathematics', 'Physics', 'Chemistry'],
                    timeframe: 'day',
                    constraints: { dailyHours: 4, startTime: '09:00', endTime: '17:00' },
                    goals: { type: 'exam_prep', deadline: '2024-02-01' }
                };
                
                const schedule = await scheduler.generateOptimizedSchedule(testData);
                
                const endTime = Date.now();
                const duration = ((endTime - startTime) / 1000).toFixed(2);

                showResult('scheduleResult', `Smart schedule generated in ${duration}s!`, 'success');
                showOutput('scheduleOutput', schedule);
                
                testResults.schedule = { success: true, duration, sessions: schedule.schedule?.length || 0 };
                completedTests++;
                updateProgress();

            } catch (error) {
                showResult('scheduleResult', `Schedule generation failed: ${error.message}`, 'error');
                showOutput('scheduleOutput', `Error: ${error.message}`);
                testResults.schedule = { success: false, error: error.message };
            }

            btn.disabled = false;
        }

        // Learning Profile Test
        async function testLearningProfile() {
            const btn = document.getElementById('profileBtn');
            btn.disabled = true;
            showResult('profileResult', 'Analyzing learning profile...', 'loading');

            try {
                const profile = new UserLearningProfile();
                const startTime = Date.now();
                
                // Simulate some learning data
                profile.updatePerformance('Mathematics', 0.85, new Date());
                profile.updatePerformance('Physics', 0.72, new Date());
                profile.updateSessionData(45, 'focused');
                
                const insights = await profile.generateInsights();
                
                const endTime = Date.now();
                const duration = ((endTime - startTime) / 1000).toFixed(2);

                showResult('profileResult', `Learning profile analyzed in ${duration}s!`, 'success');
                showOutput('profileOutput', insights);
                
                testResults.profile = { success: true, duration };
                completedTests++;
                updateProgress();

            } catch (error) {
                showResult('profileResult', `Learning profile analysis failed: ${error.message}`, 'error');
                showOutput('profileOutput', `Error: ${error.message}`);
                testResults.profile = { success: false, error: error.message };
            }

            btn.disabled = false;
        }

        // Performance Test
        async function runPerformanceTest() {
            const btn = document.getElementById('perfBtn');
            btn.disabled = true;
            showResult('perfResult', 'Running performance tests...', 'loading');

            try {
                const tests = [];
                const iterations = 3;
                
                for (let i = 0; i < iterations; i++) {
                    const startTime = Date.now();
                    
                    const provider = new LocalLLMProvider();
                    await provider.generateResponse('Test prompt ' + (i + 1));
                    
                    const endTime = Date.now();
                    tests.push(endTime - startTime);
                }
                
                const avgTime = (tests.reduce((a, b) => a + b, 0) / tests.length / 1000).toFixed(2);
                const minTime = (Math.min(...tests) / 1000).toFixed(2);
                const maxTime = (Math.max(...tests) / 1000).toFixed(2);
                
                const perfData = {
                    averageTime: avgTime + 's',
                    minTime: minTime + 's',
                    maxTime: maxTime + 's',
                    iterations: iterations,
                    model: 'llama3.2:3b'
                };

                showResult('perfResult', `Performance test completed! Avg: ${avgTime}s`, 'success');
                showOutput('perfOutput', perfData);
                
                testResults.performance = { success: true, ...perfData };
                completedTests++;
                updateProgress();

            } catch (error) {
                showResult('perfResult', `Performance test failed: ${error.message}`, 'error');
                showOutput('perfOutput', `Error: ${error.message}`);
                testResults.performance = { success: false, error: error.message };
            }

            btn.disabled = false;
        }

        // Full System Test
        async function runFullSystemTest() {
            const btn = document.getElementById('fullTestBtn');
            btn.disabled = true;
            showResult('fullTestResult', 'Running complete system test...', 'loading');

            try {
                // Reset counters
                completedTests = 0;
                testResults = {};
                updateProgress();

                // Run all tests sequentially
                await checkSystemStatus();
                await testAIChat();
                await testFlashcardGeneration();
                await testSmartSchedule();
                await testLearningProfile();
                await runPerformanceTest();

                // Generate summary
                const successCount = Object.values(testResults).filter(r => r.success).length;
                const totalCount = Object.keys(testResults).length;
                
                const summary = {
                    totalTests: totalCount,
                    successful: successCount,
                    failed: totalCount - successCount,
                    successRate: ((successCount / totalCount) * 100).toFixed(1) + '%',
                    model: 'llama3.2:3b',
                    timestamp: new Date().toISOString()
                };

                if (successCount === totalCount) {
                    showResult('fullTestResult', `üéâ All tests passed! (${successCount}/${totalCount})`, 'success');
                } else {
                    showResult('fullTestResult', `‚ö†Ô∏è ${successCount}/${totalCount} tests passed`, 'warning');
                }

                showOutput('fullTestOutput', { summary, detailedResults: testResults });

            } catch (error) {
                showResult('fullTestResult', `System test failed: ${error.message}`, 'error');
                showOutput('fullTestOutput', `Error: ${error.message}`);
            }

            btn.disabled = false;
        }

        // Initialize
        window.addEventListener('load', () => {
            setTimeout(checkSystemStatus, 1000);
        });
    </script>
</body>
</html>
